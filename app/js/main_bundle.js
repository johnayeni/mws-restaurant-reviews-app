"use strict";var _regenerator=(_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"))(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));"serviceWorker"in navigator&&window.addEventListener("load",(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(){var t;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.serviceWorker.register("sw.js");case 3:t=e.sent,console.log("ServiceWorker registration successful with scope: ",t.scope),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log("ServiceWorker registration failed: ",e.t0);case 10:case"end":return e.stop()}},e,this,[[0,7]])})));var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_idb=_interopRequireDefault(require("idb")),DBHelper=function(){function o(){(0,_classCallCheck2.default)(this,o)}var r,t;return(0,_createClass2.default)(o,null,[{key:"fetchRestaurants",value:(t=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(t){var r,n;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(o.DATABASE_URL);case 3:if(200===(r=e.sent).status)return e.next=7,r.json();e.next=11;break;case 7:n=e.sent,t(null,n),e.next=12;break;case 11:t("Could not fetch restaurants",null);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),t(e.t0,null);case 17:case"end":return e.stop()}},e,this,[[0,14]])})),function(e){return t.apply(this,arguments)})},{key:"fetchRestaurantById",value:(r=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(t,r){var n,a;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(o.DATABASE_URL,"/").concat(t));case 3:if(200===(n=e.sent).status)return e.next=7,n.json();e.next=11;break;case 7:a=e.sent,r(null,a),e.next=12;break;case 11:r("Restaurant does not exist",null);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),r(e.t0,null);case 17:case"end":return e.stop()}},e,this,[[0,14]])})),function(e,t){return r.apply(this,arguments)})},{key:"fetchRestaurantByCuisine",value:function(n,a){o.fetchRestaurants(function(e,t){if(e)a(e,null);else{var r=t.filter(function(e){return e.cuisine_type==n});a(null,r)}})}},{key:"fetchRestaurantByNeighborhood",value:function(n,a){o.fetchRestaurants(function(e,t){if(e)a(e,null);else{var r=t.filter(function(e){return e.neighborhood==n});a(null,r)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(n,a,s){o.fetchRestaurants(function(e,t){if(e)s(e,null);else{var r=t;"all"!=n&&(r=r.filter(function(e){return e.cuisine_type==n})),"all"!=a&&(r=r.filter(function(e){return e.neighborhood==a})),s(null,r)}})}},{key:"fetchNeighborhoods",value:function(a){o.fetchRestaurants(function(e,r){if(e)a(e,null);else{var n=r.map(function(e,t){return r[t].neighborhood}),t=n.filter(function(e,t){return n.indexOf(e)==t});a(null,t)}})}},{key:"fetchCuisines",value:function(a){o.fetchRestaurants(function(e,r){if(e)a(e,null);else{var n=r.map(function(e,t){return r[t].cuisine_type}),t=n.filter(function(e,t){return n.indexOf(e)==t});a(null,t)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id=".concat(e.id)}},{key:"imageUrlForRestaurant",value:function(e){return"/img/".concat(e.photograph,".jpg")}},{key:"mapMarkerForRestaurant",value:function(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:o.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:".concat(1337,"/restaurants")}}]),o}(),_default=DBHelper;exports.default=_default;var restaurants,neighborhoods,cuisines,map,observer,_dbhelper=(_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"))(require("./dbhelper")),markers=[],numSteps=20;document.addEventListener("DOMContentLoaded",function(e){setIntersectObservers(),setEventListeners(),fetchNeighborhoods(),fetchCuisines()});var setEventListeners=function(){document.getElementById("neighborhoods-select").addEventListener("change",function(){updateRestaurants()}),document.getElementById("cuisines-select").addEventListener("change",function(){updateRestaurants()})},setIntersectObservers=function(){var e={root:document.querySelector("#scrollArea"),rootMargin:"0px",threshold:buildThresholdList()};observer=new IntersectionObserver(handleIntersect,e)},buildThresholdList=function(){for(var e=[],t=1;t<=numSteps;t++){var r=t/numSteps;e.push(r)}return e.push(0),e},handleIntersect=function(e,t){e.forEach(function(e){.25<e.intersectionRatio&&(e.target.classList.remove("hidden"),e.target.classList.add("show"))})},fetchNeighborhoods=function(){_dbhelper.default.fetchNeighborhoods(function(e,t){null!=e?console.error(e):(neighborhoods=t,fillNeighborhoodsHTML())})},fillNeighborhoodsHTML=function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:neighborhoods,a=document.getElementById("neighborhoods-select");n.forEach(function(e,t){var r=document.createElement("option");r.innerHTML=e,r.value=e,r.setAttribute("role","option"),r.setAttribute("aria-posinset",t+1),r.setAttribute("aria-setsize",n.length),a.append(r)})},fetchCuisines=function(){_dbhelper.default.fetchCuisines(function(e,t){e?console.error(e):(cuisines=t,fillCuisinesHTML())})},fillCuisinesHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:cuisines,n=document.getElementById("cuisines-select");e.forEach(function(e,t){var r=document.createElement("option");r.innerHTML=e,r.value=e,r.setAttribute("role","option"),r.setAttribute("aria-posinset",t+1),r.setAttribute("aria-setsize",cuisines.length),n.append(r)})};window.initMap=function(){map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()};var updateRestaurants=function(){var e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),r=e.selectedIndex,n=t.selectedIndex,a=e[r].value,s=t[n].value;console.log("change"),_dbhelper.default.fetchRestaurantByCuisineAndNeighborhood(a,s,function(e,t){e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})},resetRestaurants=function(e){restaurants=[],document.getElementById("restaurants-list").innerHTML="",markers.forEach(function(e){return e.setMap(null)}),markers=[],restaurants=e},fillRestaurantsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:restaurants,t=document.getElementById("restaurants-list");e.forEach(function(e){t.append(createRestaurantHTML(e))}),addMarkersToMap()},createRestaurantHTML=function(e){var t=document.createElement("li");t.className="post",t.setAttribute("role","listitem");var r=document.createElement("img");r.className="restaurant-img",r.src=_dbhelper.default.imageUrlForRestaurant(e),r.alt=e.name+" restaurant's photo.",t.append(r);var n=document.createElement("h2");n.innerHTML=e.name,n.tabIndex=0,n.setAttribute("aria-label","".concat(e.name," , ").concat(e.neighborhood)),t.append(n);var a=document.createElement("p");a.innerHTML=e.neighborhood,t.append(a);var s=document.createElement("p");s.innerHTML=e.address,t.append(s);var o=document.createElement("a");return o.innerHTML="View Details",o.href=_dbhelper.default.urlForRestaurant(e),o.setAttribute("aria-label","View details of ".concat(e.name,"'s restaurant")),t.append(o),t.classList.add("hidden"),observer.observe(t),t},addMarkersToMap=function(){(0<arguments.length&&void 0!==arguments[0]?arguments[0]:restaurants).forEach(function(e){var t=_dbhelper.default.mapMarkerForRestaurant(e,map);google.maps.event.addListener(t,"click",function(){window.location.href=t.url}),markers.push(t)})};
//# sourceMappingURL=main_bundle.js.map
