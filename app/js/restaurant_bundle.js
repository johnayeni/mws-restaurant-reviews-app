"use strict";var _regenerator=(_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"))(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));"serviceWorker"in navigator&&window.addEventListener("load",(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(){var t;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.serviceWorker.register("sw.js");case 3:t=e.sent,console.log("ServiceWorker registration successful with scope: ",t.scope),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log("ServiceWorker registration failed: ",e.t0);case 10:case"end":return e.stop()}},e,this,[[0,7]])})));var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_idb=_interopRequireDefault(require("idb")),DBHelper=function(){function i(){(0,_classCallCheck2.default)(this,i)}var r,t;return(0,_createClass2.default)(i,null,[{key:"fetchRestaurants",value:(t=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(t){var r,n;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(i.DATABASE_URL);case 3:if(200===(r=e.sent).status)return e.next=7,r.json();e.next=11;break;case 7:n=e.sent,t(null,n),e.next=12;break;case 11:t("Could not fetch restaurants",null);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),t(e.t0,null);case 17:case"end":return e.stop()}},e,this,[[0,14]])})),function(e){return t.apply(this,arguments)})},{key:"fetchRestaurantById",value:(r=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(t,r){var n,a;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(i.DATABASE_URL,"/").concat(t));case 3:if(200===(n=e.sent).status)return e.next=7,n.json();e.next=11;break;case 7:a=e.sent,r(null,a),e.next=12;break;case 11:r("Restaurant does not exist",null);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),r(e.t0,null);case 17:case"end":return e.stop()}},e,this,[[0,14]])})),function(e,t){return r.apply(this,arguments)})},{key:"fetchRestaurantByCuisine",value:function(n,a){i.fetchRestaurants(function(e,t){if(e)a(e,null);else{var r=t.filter(function(e){return e.cuisine_type==n});a(null,r)}})}},{key:"fetchRestaurantByNeighborhood",value:function(n,a){i.fetchRestaurants(function(e,t){if(e)a(e,null);else{var r=t.filter(function(e){return e.neighborhood==n});a(null,r)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(n,a,u){i.fetchRestaurants(function(e,t){if(e)u(e,null);else{var r=t;"all"!=n&&(r=r.filter(function(e){return e.cuisine_type==n})),"all"!=a&&(r=r.filter(function(e){return e.neighborhood==a})),u(null,r)}})}},{key:"fetchNeighborhoods",value:function(a){i.fetchRestaurants(function(e,r){if(e)a(e,null);else{var n=r.map(function(e,t){return r[t].neighborhood}),t=n.filter(function(e,t){return n.indexOf(e)==t});a(null,t)}})}},{key:"fetchCuisines",value:function(a){i.fetchRestaurants(function(e,r){if(e)a(e,null);else{var n=r.map(function(e,t){return r[t].cuisine_type}),t=n.filter(function(e,t){return n.indexOf(e)==t});a(null,t)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id=".concat(e.id)}},{key:"imageUrlForRestaurant",value:function(e){return"/img/".concat(e.photograph,".jpg")}},{key:"mapMarkerForRestaurant",value:function(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:i.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:".concat(1337,"/restaurants")}}]),i}(),_default=DBHelper;exports.default=_default;var restaurant,map,_dbhelper=(_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"))(require("./dbhelper"));window.initMap=function(){fetchRestaurantFromURL(function(e,t){e?console.error(e):(map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),_dbhelper.default.mapMarkerForRestaurant(restaurant,map))})};var fetchRestaurantFromURL=function(r){if(restaurant)r(null,restaurant);else{var e=getParameterByName("id");if(e)_dbhelper.default.fetchRestaurantById(e,function(e,t){(restaurant=t)?(fillRestaurantHTML(),r(null,t)):console.error(e)});else{r("No restaurant id in URL",null)}}},fillRestaurantHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:restaurant;document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;var t=document.getElementById("restaurant-img");t.className="restaurant-img",t.src=_dbhelper.default.imageUrlForRestaurant(restaurant),t.alt=e.name+" restaurant's photo.",document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,restaurant.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()},fillRestaurantHoursHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var r in e){var n=document.createElement("tr"),a=document.createElement("td");a.innerHTML=r,n.appendChild(a);var u=document.createElement("td");u.innerHTML=e[r],n.appendChild(u),t.appendChild(n)}},fillReviewsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:restaurant.reviews,t=document.getElementById("reviews-container"),r=document.createElement("h3");if(r.innerHTML="Reviews",t.appendChild(r),!e){var n=document.createElement("p");return n.innerHTML="No reviews yet!",void t.appendChild(n)}var a=document.getElementById("reviews-list");e.forEach(function(e){a.appendChild(createReviewHTML(e))}),t.appendChild(a)},createReviewHTML=function(e){var t=document.createElement("li");t.tabIndex=0;var r=document.createElement("h4");r.innerHTML=e.name,t.appendChild(r);var n=document.createElement("h6");n.innerHTML=e.date,t.appendChild(n);var a=document.createElement("h5");a.innerHTML="Rating: ".concat(e.rating),t.appendChild(a);var u=document.createElement("p");return u.innerHTML=e.comments,t.appendChild(u),t},fillBreadcrumb=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:restaurant,t=document.getElementById("breadcrumb"),r=document.createElement("li");r.innerHTML=e.name,t.appendChild(r)},getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]".concat(e,"(=([^&#]*)|&|#|$)")).exec(t);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null};
//# sourceMappingURL=restaurant_bundle.js.map
